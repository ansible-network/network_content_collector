
- name: "Create the test directories"
  file:
    path: "{{ item }}"
    state: directory
  with_items: "{{ directories['test'] }}"

- name: Create target-prefixes.network for ansible-test
  copy:
    content: "{{ collection_name }}"
    dest: "{{ collection_parent }}/test/integration/target-prefixes.network"

- name: Set fact for patterns
  set_fact:
    __test_patterns:
      - "{{ collection_name }}_*"
      - "prepare_{{ collection_name }}_tests"

- name: Enable netconf patterns
  set_fact:
    __test_patterns: "{{ __test_patterns }} + ['prepare_junos_tests', 'prepare_iosxr_tests']"
  when: collection_name in ["netconf"]

- name: Build a list of the directories in the test directory
  find:
    paths: "{{ ansible_source_directory }}/test/integration/targets"
    patterns: "{{ __test_patterns }}"
    file_type: directory
  connection: local
  register: test_source_directories

- name: Copy each test integration directory into the collection
  include: migrate_test_directory.yaml
  loop: "{{ test_source_directories['files'] }}"
  loop_control:
    loop_var: directory
